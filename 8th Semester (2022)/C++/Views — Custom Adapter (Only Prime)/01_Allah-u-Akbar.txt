#include <fmt/ranges.h>
#include <ranges>
namespace rg = std::ranges;
namespace vs = rg::views;

struct only_prime : std::ranges::range_adaptor_closure<only_prime>
{
	using value_type = std::size_t;

	static constexpr auto square_root(const value_type n) noexcept
	{
		if (n <= 1) return n;

		value_type left = 1, right = n;
		while (left <= right)
		{
			const auto mid = left + (right - left) / 2;
			if (mid == n / mid) return mid;
			else if (mid < n / mid) left = mid + 1;
			else right = mid - 1;
		}
		return right;
	}

	static constexpr auto is_prime(const value_type x) noexcept
	{
		for (auto i = square_root(x); i > 1; --i)
			if (x % i == 0) return false;
		return true;
	}

	constexpr auto operator()(const std::ranges::range auto r) const noexcept
	{
		return r | std::views::filter(is_prime);
	}
};

int main()
{
	auto my_range = vs::iota(0) | only_prime{} | vs::take(25);
	fmt::print("{}", my_range);
}